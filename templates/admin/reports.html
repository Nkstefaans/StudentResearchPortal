{% extends "layout.html" %}

{% block title %}Reports - Student Research Management System{% endblock %}

{% block content %}
<div class="container">
    <div class="row mb-4">
        <div class="col-md-12">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="{{ url_for('admin_dashboard') }}">Dashboard</a></li>
                    <li class="breadcrumb-item active" aria-current="page">Reports</li>
                </ol>
            </nav>
        </div>
    </div>
    
    <div class="row mb-4">
        <div class="col-md-12">
            <div class="card role-admin">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h2 class="card-title mb-0">System Reports</h2>
                            <p class="text-muted">View and export data reports</p>
                        </div>
                        <div>
                            <button id="print-report" class="btn btn-primary">
                                <i class="fas fa-print me-2"></i> Print Report
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="row mb-4">
        <div class="col-md-12">
            <div class="card">
                <div class="card-header">
                    <ul class="nav nav-tabs card-header-tabs" id="reportTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="overview-tab" data-bs-toggle="tab" data-bs-target="#overview" type="button" role="tab" aria-controls="overview" aria-selected="true">Overview</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="theses-tab" data-bs-toggle="tab" data-bs-target="#theses" type="button" role="tab" aria-controls="theses" aria-selected="false">Thesis Reports</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="nominations-tab" data-bs-toggle="tab" data-bs-target="#nominations" type="button" role="tab" aria-controls="nominations" aria-selected="false">Nomination Reports</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="reviews-tab" data-bs-toggle="tab" data-bs-target="#reviews" type="button" role="tab" aria-controls="reviews" aria-selected="false">Review Reports</button>
                        </li>
                    </ul>
                </div>
                <div class="card-body">
                    <div class="tab-content" id="reportTabsContent">
                        <!-- Overview Tab -->
                        <div class="tab-pane fade show active" id="overview" role="tabpanel" aria-labelledby="overview-tab">
                            <div class="row mb-4">
                                <div class="col-md-4">
                                    <div class="card">
                                        <div class="card-header bg-primary text-white">
                                            <h5 class="mb-0">User Statistics</h5>
                                        </div>
                                        <div class="card-body">
                                            <div class="chart-container" style="position: relative; height: 250px;">
                                                <canvas id="userPieChart"></canvas>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-8">
                                    <div class="card">
                                        <div class="card-header bg-primary text-white">
                                            <h5 class="mb-0">Theses by Status</h5>
                                        </div>
                                        <div class="card-body">
                                            <div class="chart-container" style="position: relative; height: 250px;">
                                                <canvas id="thesisBarChart"></canvas>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="card">
                                        <div class="card-header bg-primary text-white">
                                            <h5 class="mb-0">Key Performance Indicators</h5>
                                        </div>
                                        <div class="card-body">
                                            <div class="row">
                                                <div class="col-md-6 mb-3">
                                                    <div class="card bg-light">
                                                        <div class="card-body text-center">
                                                            <h6 class="text-muted">Avg. Review Time</h6>
                                                            <h2 class="mb-0">{{ avg_completion_time|round(1) }} days</h2>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-md-6 mb-3">
                                                    <div class="card bg-light">
                                                        <div class="card-body text-center">
                                                            <h6 class="text-muted">Nomination Approval Rate</h6>
                                                            {% set approved = nomination_counts|selectattr('0', 'equalto', 'approved')|list %}
                                                            {% set total = 0 %}
                                                            {% for status, count in nomination_counts %}
                                                                {% set total = total + count %}
                                                            {% endfor %}
                                                            {% set rate = (approved[0][1] / total * 100) if total > 0 and approved else 0 %}
                                                            <h2 class="mb-0">{{ rate|round(1) }}%</h2>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <div class="card bg-light">
                                                        <div class="card-body text-center">
                                                            <h6 class="text-muted">On-Time Completion</h6>
                                                            <h2 class="mb-0">85.7%</h2>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <div class="card bg-light">
                                                        <div class="card-body text-center">
                                                            <h6 class="text-muted">Active Theses</h6>
                                                            <h2 class="mb-0">{{ theses|length }}</h2>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="card">
                                        <div class="card-header bg-primary text-white">
                                            <h5 class="mb-0">System Activity Log</h5>
                                        </div>
                                        <div class="card-body p-0">
                                            <ul class="list-group list-group-flush">
                                                <li class="list-group-item">
                                                    <div class="d-flex align-items-center">
                                                        <span class="badge bg-primary me-3">Thesis</span>
                                                        <div>
                                                            <p class="mb-0">New thesis submitted by <strong>John Smith</strong></p>
                                                            <small class="text-muted">Today, 10:30 AM</small>
                                                        </div>
                                                    </div>
                                                </li>
                                                <li class="list-group-item">
                                                    <div class="d-flex align-items-center">
                                                        <span class="badge bg-warning me-3">Review</span>
                                                        <div>
                                                            <p class="mb-0">Thesis review completed by <strong>Dr. Alice Johnson</strong></p>
                                                            <small class="text-muted">Yesterday, 3:45 PM</small>
                                                        </div>
                                                    </div>
                                                </li>
                                                <li class="list-group-item">
                                                    <div class="d-flex align-items-center">
                                                        <span class="badge bg-success me-3">Approval</span>
                                                        <div>
                                                            <p class="mb-0">Examiner nominations approved by <strong>Margaret Wilson</strong></p>
                                                            <small class="text-muted">Yesterday, 11:15 AM</small>
                                                        </div>
                                                    </div>
                                                </li>
                                                <li class="list-group-item">
                                                    <div class="d-flex align-items-center">
                                                        <span class="badge bg-info me-3">Nomination</span>
                                                        <div>
                                                            <p class="mb-0">New examiner nominations by <strong>Prof. Robert Brown</strong></p>
                                                            <small class="text-muted">3 days ago</small>
                                                        </div>
                                                    </div>
                                                </li>
                                                <li class="list-group-item">
                                                    <div class="d-flex align-items-center">
                                                        <span class="badge bg-secondary me-3">User</span>
                                                        <div>
                                                            <p class="mb-0">New user registered: <strong>David Williams (Examiner)</strong></p>
                                                            <small class="text-muted">1 week ago</small>
                                                        </div>
                                                    </div>
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Thesis Reports Tab -->
                        <div class="tab-pane fade" id="theses" role="tabpanel" aria-labelledby="theses-tab">
                            <div class="row mb-4">
                                <div class="col-md-12">
                                    <div class="card">
                                        <div class="card-header">
                                            <div class="d-flex justify-content-between align-items-center">
                                                <h5 class="mb-0">Thesis Status Summary</h5>
                                                <div class="btn-group">
                                                    <button class="btn btn-sm btn-outline-secondary">
                                                        <i class="fas fa-file-excel me-1"></i> Export Excel
                                                    </button>
                                                    <button class="btn btn-sm btn-outline-secondary">
                                                        <i class="fas fa-file-pdf me-1"></i> Export PDF
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="card-body">
                                            <div class="table-responsive">
                                                <table class="table table-bordered">
                                                    <thead class="table-primary">
                                                        <tr>
                                                            <th>Status</th>
                                                            <th>Count</th>
                                                            <th>Percentage</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        {% set total_theses = 0 %}
                                                        {% for status, count in status_counts %}
                                                            {% set total_theses = total_theses + count %}
                                                        {% endfor %}
                                                        
                                                        {% for status, count in status_counts %}
                                                            <tr>
                                                                <td>
                                                                    {% if status == 'submitted' %}
                                                                        <span class="badge status-badge status-submitted">Submitted</span>
                                                                    {% elif status == 'nomination_submitted' %}
                                                                        <span class="badge status-badge status-nomination">Nomination Submitted</span>
                                                                    {% elif status == 'examiners_approved' %}
                                                                        <span class="badge status-badge status-approved">Examiners Approved</span>
                                                                    {% elif status == 'under_review' %}
                                                                        <span class="badge status-badge status-review">Under Review</span>
                                                                    {% elif status == 'completed' %}
                                                                        <span class="badge status-badge status-completed">Completed</span>
                                                                    {% endif %}
                                                                    {{ status.replace('_', ' ').title() }}
                                                                </td>
                                                                <td>{{ count }}</td>
                                                                <td>
                                                                    {% if total_theses > 0 %}
                                                                        {{ (count / total_theses * 100)|round(1) }}%
                                                                    {% else %}
                                                                        0%
                                                                    {% endif %}
                                                                </td>
                                                            </tr>
                                                        {% endfor %}
                                                    </tbody>
                                                    <tfoot class="table-secondary">
                                                        <tr>
                                                            <th>Total</th>
                                                            <th>{{ total_theses }}</th>
                                                            <th>100%</th>
                                                        </tr>
                                                    </tfoot>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="card">
                                        <div class="card-header">
                                            <div class="d-flex justify-content-between align-items-center">
                                                <h5 class="mb-0">Thesis Details</h5>
                                                <div class="input-group" style="max-width: 300px;">
                                                    <input type="text" class="form-control form-control-sm" placeholder="Search theses...">
                                                    <button class="btn btn-sm btn-outline-secondary" type="button">
                                                        <i class="fas fa-search"></i>
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="card-body">
                                            <div class="table-responsive">
                                                <table class="table table-hover">
                                                    <thead>
                                                        <tr>
                                                            <th>ID</th>
                                                            <th>Title</th>
                                                            <th>Student</th>
                                                            <th>Supervisor</th>
                                                            <th>Submission Date</th>
                                                            <th>Status</th>
                                                            <th>Degree</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        {% for thesis in theses %}
                                                            <tr>
                                                                <td>{{ thesis.id }}</td>
                                                                <td>{{ thesis.title }}</td>
                                                                <td>{{ thesis.student.user.first_name }} {{ thesis.student.user.last_name }}</td>
                                                                <td>{{ thesis.supervisor.user.first_name }} {{ thesis.supervisor.user.last_name }}</td>
                                                                <td>{{ thesis.submission_date.strftime('%Y-%m-%d') }}</td>
                                                                <td>
                                                                    {% if thesis.status == 'submitted' %}
                                                                        <span class="badge status-badge status-submitted">Submitted</span>
                                                                    {% elif thesis.status == 'nomination_submitted' %}
                                                                        <span class="badge status-badge status-nomination">Nomination Submitted</span>
                                                                    {% elif thesis.status == 'examiners_approved' %}
                                                                        <span class="badge status-badge status-approved">Examiners Approved</span>
                                                                    {% elif thesis.status == 'under_review' %}
                                                                        <span class="badge status-badge status-review">Under Review</span>
                                                                    {% elif thesis.status == 'completed' %}
                                                                        <span class="badge status-badge status-completed">Completed</span>
                                                                    {% endif %}
                                                                </td>
                                                                <td>{{ thesis.student.degree_type }}</td>
                                                            </tr>
                                                        {% endfor %}
                                                    </tbody>
                                                </table>
                                            </div>
                                            
                                            <!-- Pagination -->
                                            <nav aria-label="Thesis pagination" class="mt-4">
                                                <ul class="pagination justify-content-center">
                                                    <li class="page-item disabled">
                                                        <a class="page-link" href="#" tabindex="-1" aria-disabled="true">Previous</a>
                                                    </li>
                                                    <li class="page-item active"><a class="page-link" href="#">1</a></li>
                                                    <li class="page-item"><a class="page-link" href="#">2</a></li>
                                                    <li class="page-item"><a class="page-link" href="#">3</a></li>
                                                    <li class="page-item">
                                                        <a class="page-link" href="#">Next</a>
                                                    </li>
                                                </ul>
                                            </nav>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Nomination Reports Tab -->
                        <div class="tab-pane fade" id="nominations" role="tabpanel" aria-labelledby="nominations-tab">
                            <div class="row mb-4">
                                <div class="col-md-6">
                                    <div class="card">
                                        <div class="card-header">
                                            <h5 class="mb-0">Nomination Status Summary</h5>
                                        </div>
                                        <div class="card-body">
                                            <div class="chart-container" style="position: relative; height: 250px;">
                                                <canvas id="nominationPieChart"></canvas>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="card">
                                        <div class="card-header">
                                            <h5 class="mb-0">Nomination Statistics</h5>
                                        </div>
                                        <div class="card-body">
                                            <div class="table-responsive">
                                                <table class="table table-bordered">
                                                    <thead class="table-primary">
                                                        <tr>
                                                            <th>Status</th>
                                                            <th>Count</th>
                                                            <th>Percentage</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        {% set total_nominations = 0 %}
                                                        {% for status, count in nomination_counts %}
                                                            {% set total_nominations = total_nominations + count %}
                                                        {% endfor %}
                                                        
                                                        {% for status, count in nomination_counts %}
                                                            <tr>
                                                                <td>
                                                                    {% if status == 'approved' %}
                                                                        <span class="badge bg-success">Approved</span>
                                                                    {% elif status == 'rejected' %}
                                                                        <span class="badge bg-danger">Rejected</span>
                                                                    {% elif status == 'pending' %}
                                                                        <span class="badge bg-warning">Pending</span>
                                                                    {% endif %}
                                                                    {{ status.capitalize() }}
                                                                </td>
                                                                <td>{{ count }}</td>
                                                                <td>
                                                                    {% if total_nominations > 0 %}
                                                                        {{ (count / total_nominations * 100)|round(1) }}%
                                                                    {% else %}
                                                                        0%
                                                                    {% endif %}
                                                                </td>
                                                            </tr>
                                                        {% endfor %}
                                                    </tbody>
                                                    <tfoot class="table-secondary">
                                                        <tr>
                                                            <th>Total</th>
                                                            <th>{{ total_nominations }}</th>
                                                            <th>100%</th>
                                                        </tr>
                                                    </tfoot>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="card">
                                        <div class="card-header">
                                            <h5 class="mb-0">Institution Distribution</h5>
                                        </div>
                                        <div class="card-body">
                                            <p class="text-muted">Distribution of nominated examiners by institution</p>
                                            <div class="chart-container" style="position: relative; height: 300px;">
                                                <canvas id="institutionBarChart"></canvas>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Review Reports Tab -->
                        <div class="tab-pane fade" id="reviews" role="tabpanel" aria-labelledby="reviews-tab">
                            <div class="row mb-4">
                                <div class="col-md-6">
                                    <div class="card">
                                        <div class="card-header">
                                            <h5 class="mb-0">Review Completion Time</h5>
                                        </div>
                                        <div class="card-body">
                                            <div class="row text-center">
                                                <div class="col-md-6 mb-3">
                                                    <div class="card bg-light">
                                                        <div class="card-body">
                                                            <h6 class="text-muted">Average Completion Time</h6>
                                                            <h2 class="mb-0">{{ avg_completion_time|round(1) }} days</h2>
                                                            <small class="text-muted">Out of 42 day deadline</small>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-md-6 mb-3">
                                                    <div class="card bg-light">
                                                        <div class="card-body">
                                                            <h6 class="text-muted">On-Time Completion Rate</h6>
                                                            <h2 class="mb-0">85.7%</h2>
                                                            <small class="text-muted">6 weeks or less</small>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="chart-container mt-3" style="position: relative; height: 200px;">
                                                <canvas id="completionTimeChart"></canvas>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="card">
                                        <div class="card-header">
                                            <h5 class="mb-0">Review Grades Distribution</h5>
                                        </div>
                                        <div class="card-body">
                                            <div class="chart-container" style="position: relative; height: 300px;">
                                                <canvas id="gradesChart"></canvas>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="card">
                                        <div class="card-header">
                                            <div class="d-flex justify-content-between align-items-center">
                                                <h5 class="mb-0">Review Details</h5>
                                                <div class="btn-group">
                                                    <button class="btn btn-sm btn-outline-secondary">
                                                        <i class="fas fa-file-excel me-1"></i> Export Excel
                                                    </button>
                                                    <button class="btn btn-sm btn-outline-secondary">
                                                        <i class="fas fa-file-pdf me-1"></i> Export PDF
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="card-body">
                                            <div class="table-responsive">
                                                <table class="table table-hover">
                                                    <thead>
                                                        <tr>
                                                            <th>Thesis</th>
                                                            <th>Examiner</th>
                                                            <th>Deadline</th>
                                                            <th>Submission Date</th>
                                                            <th>Days Taken</th>
                                                            <th>Status</th>
                                                            <th>Grade</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        {% for thesis in theses %}
                                                            {% for review in thesis.reviews %}
                                                                <tr>
                                                                    <td>{{ thesis.title }}</td>
                                                                    <td>{{ review.examiner.title }} {{ review.examiner.user.first_name }} {{ review.examiner.user.last_name }}</td>
                                                                    <td>{{ review.deadline.strftime('%Y-%m-%d') }}</td>
                                                                    <td>
                                                                        {% if review.submission_date %}
                                                                            {{ review.submission_date.strftime('%Y-%m-%d') }}
                                                                        {% else %}
                                                                            -
                                                                        {% endif %}
                                                                    </td>
                                                                    <td>
                                                                        {% if review.submission_date and thesis.nominations %}
                                                                            {% set nomination = thesis.nominations|selectattr('examiner_id', 'equalto', review.examiner_id)|first %}
                                                                            {% if nomination and nomination.sent_date %}
                                                                                {{ (review.submission_date - nomination.sent_date).days }}
                                                                            {% else %}
                                                                                -
                                                                            {% endif %}
                                                                        {% else %}
                                                                            -
                                                                        {% endif %}
                                                                    </td>
                                                                    <td>
                                                                        {% if review.status == 'completed' %}
                                                                            <span class="badge bg-success">Completed</span>
                                                                        {% elif review.status == 'pending' %}
                                                                            <span class="badge bg-warning">Pending</span>
                                                                        {% endif %}
                                                                    </td>
                                                                    <td>
                                                                        {% if review.grade == 'excellent' %}
                                                                            <span class="badge bg-success">Excellent</span>
                                                                        {% elif review.grade == 'good' %}
                                                                            <span class="badge bg-info">Good</span>
                                                                        {% elif review.grade == 'acceptable' %}
                                                                            <span class="badge bg-warning">Acceptable</span>
                                                                        {% elif review.grade == 'poor' %}
                                                                            <span class="badge bg-danger">Poor</span>
                                                                        {% else %}
                                                                            -
                                                                        {% endif %}
                                                                    </td>
                                                                </tr>
                                                            {% endfor %}
                                                        {% endfor %}
                                                    </tbody>
                                                </table>
                                            </div>
                                            
                                            <!-- Pagination -->
                                            <nav aria-label="Reviews pagination" class="mt-4">
                                                <ul class="pagination justify-content-center">
                                                    <li class="page-item disabled">
                                                        <a class="page-link" href="#" tabindex="-1" aria-disabled="true">Previous</a>
                                                    </li>
                                                    <li class="page-item active"><a class="page-link" href="#">1</a></li>
                                                    <li class="page-item"><a class="page-link" href="#">2</a></li>
                                                    <li class="page-item"><a class="page-link" href="#">3</a></li>
                                                    <li class="page-item">
                                                        <a class="page-link" href="#">Next</a>
                                                    </li>
                                                </ul>
                                            </nav>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // User Pie Chart
        var userPieCtx = document.getElementById('userPieChart').getContext('2d');
        var userPieChart = new Chart(userPieCtx, {
            type: 'pie',
            data: {
                labels: ['Students', 'Lecturers', 'Examiners', 'Postgrad Office'],
                datasets: [{
                    data: [{{ student_count }}, {{ lecturer_count }}, {{ examiner_count }}, {{ postgrad_count }}],
                    backgroundColor: [
                        'rgba(13, 110, 253, 0.7)',
                        'rgba(23, 162, 184, 0.7)',
                        'rgba(255, 193, 7, 0.7)',
                        'rgba(40, 167, 69, 0.7)'
                    ],
                    borderColor: [
                        'rgba(13, 110, 253, 1)',
                        'rgba(23, 162, 184, 1)',
                        'rgba(255, 193, 7, 1)',
                        'rgba(40, 167, 69, 1)'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'right'
                    }
                }
            }
        });
        
        // Thesis Bar Chart
        var thesisBarCtx = document.getElementById('thesisBarChart').getContext('2d');
        var thesisBarChart = new Chart(thesisBarCtx, {
            type: 'bar',
            data: {
                labels: ['Submitted', 'Nomination Submitted', 'Examiners Approved', 'Under Review', 'Completed'],
                datasets: [{
                    label: 'Thesis Count',
                    data: [
                        {% for status, count in status_counts %}
                            {{ count }},
                        {% endfor %}
                    ],
                    backgroundColor: [
                        'rgba(13, 110, 253, 0.7)',
                        'rgba(23, 162, 184, 0.7)',
                        'rgba(40, 167, 69, 0.7)',
                        'rgba(255, 193, 7, 0.7)',
                        'rgba(108, 117, 125, 0.7)'
                    ],
                    borderColor: [
                        'rgba(13, 110, 253, 1)',
                        'rgba(23, 162, 184, 1)',
                        'rgba(40, 167, 69, 1)',
                        'rgba(255, 193, 7, 1)',
                        'rgba(108, 117, 125, 1)'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            precision: 0
                        }
                    }
                }
            }
        });
        
        // Nomination Pie Chart
        var nominationPieCtx = document.getElementById('nominationPieChart').getContext('2d');
        var nominationPieChart = new Chart(nominationPieCtx, {
            type: 'pie',
            data: {
                labels: ['Approved', 'Rejected', 'Pending'],
                datasets: [{
                    data: [
                        {% for status, count in nomination_counts %}
                            {{ count }},
                        {% endfor %}
                    ],
                    backgroundColor: [
                        'rgba(40, 167, 69, 0.7)',
                        'rgba(220, 53, 69, 0.7)',
                        'rgba(255, 193, 7, 0.7)'
                    ],
                    borderColor: [
                        'rgba(40, 167, 69, 1)',
                        'rgba(220, 53, 69, 1)',
                        'rgba(255, 193, 7, 1)'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'right'
                    }
                }
            }
        });
        
        // Institution Bar Chart (Mock data)
        var institutionBarCtx = document.getElementById('institutionBarChart').getContext('2d');
        var institutionBarChart = new Chart(institutionBarCtx, {
            type: 'bar',
            data: {
                labels: ['University A', 'University B', 'University C', 'University D', 'University E', 'Other'],
                datasets: [{
                    label: 'Examiner Count',
                    data: [12, 8, 6, 5, 4, 7],
                    backgroundColor: 'rgba(23, 162, 184, 0.7)',
                    borderColor: 'rgba(23, 162, 184, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            precision: 0
                        }
                    }
                }
            }
        });
        
        // Completion Time Chart (Mock data)
        var completionTimeCtx = document.getElementById('completionTimeChart').getContext('2d');
        var completionTimeChart = new Chart(completionTimeCtx, {
            type: 'bar',
            data: {
                labels: ['0-10 days', '11-20 days', '21-30 days', '31-40 days', '41-42 days', '>42 days'],
                datasets: [{
                    label: 'Review Count',
                    data: [5, 15, 12, 8, 4, 2],
                    backgroundColor: [
                        'rgba(40, 167, 69, 0.7)',
                        'rgba(40, 167, 69, 0.7)',
                        'rgba(255, 193, 7, 0.7)',
                        'rgba(255, 193, 7, 0.7)',
                        'rgba(255, 193, 7, 0.7)',
                        'rgba(220, 53, 69, 0.7)'
                    ],
                    borderColor: [
                        'rgba(40, 167, 69, 1)',
                        'rgba(40, 167, 69, 1)',
                        'rgba(255, 193, 7, 1)',
                        'rgba(255, 193, 7, 1)',
                        'rgba(255, 193, 7, 1)',
                        'rgba(220, 53, 69, 1)'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            precision: 0
                        }
                    }
                }
            }
        });
        
        // Grades Chart (Mock data)
        var gradesCtx = document.getElementById('gradesChart').getContext('2d');
        var gradesChart = new Chart(gradesCtx, {
            type: 'bar',
            data: {
                labels: ['Excellent', 'Good', 'Acceptable', 'Poor'],
                datasets: [{
                    label: 'Grade Distribution',
                    data: [12, 18, 8, 2],
                    backgroundColor: [
                        'rgba(40, 167, 69, 0.7)',
                        'rgba(23, 162, 184, 0.7)',
                        'rgba(255, 193, 7, 0.7)',
                        'rgba(220, 53, 69, 0.7)'
                    ],
                    borderColor: [
                        'rgba(40, 167, 69, 1)',
                        'rgba(23, 162, 184, 1)',
                        'rgba(255, 193, 7, 1)',
                        'rgba(220, 53, 69, 1)'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            precision: 0
                        }
                    }
                }
            }
        });
    });
</script>
{% endblock %}
{% endblock %}
